app-id: org.jeremy.BrightEyes
runtime: org.gnome.Platform
runtime-version: '49'
sdk: org.gnome.Sdk
command: brighteyes
finish-args:
  - --socket=wayland
  - --socket=x11
  - --device=dri
  - --filesystem=home
  - --share=network
build-options:
  cflags: -O2 -g
  cxxflags: -O2 -g
modules:
  # Image I/O helper for tesseract
  - name: leptonica
    buildsystem: autotools
    cleanup:
      - /bin
      - /share/doc
      - /share/man
    sources:
      - type: git
        url: https://github.com/DanBloomberg/leptonica.git
        tag: 1.84.1

  # OCR engine
  - name: tesseract
    buildsystem: cmake
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DBUILD_SHARED_LIBS=ON
      - -DSTATIC=OFF
      - -DSW_BUILD=OFF
      - -DBUILD_TRAINING_TOOLS=OFF
    cleanup:
      - /share/doc
      - /share/man
    sources:
      - type: git
        url: https://github.com/tesseract-ocr/tesseract.git
        tag: 5.4.0

  # Tesseract language data (fast variant) matching settings menu
  - name: tessdata
    buildsystem: simple
    sources:
      - type: git
        url: https://github.com/tesseract-ocr/tessdata_fast.git
        branch: main
    build-commands:
      - install -Dm644 eng.traineddata /app/share/tessdata/eng.traineddata
      - install -Dm644 deu.traineddata /app/share/tessdata/deu.traineddata
      - install -Dm644 fra.traineddata /app/share/tessdata/fra.traineddata
      - install -Dm644 spa.traineddata /app/share/tessdata/spa.traineddata
      - install -Dm644 ita.traineddata /app/share/tessdata/ita.traineddata
      - install -Dm644 por.traineddata /app/share/tessdata/por.traineddata
      - install -Dm644 jpn.traineddata /app/share/tessdata/jpn.traineddata
      - install -Dm644 chi_sim.traineddata /app/share/tessdata/chi_sim.traineddata
      # Combo languages just need underlying files present

  # Application
  - name: brighteyes
    buildsystem: meson
    config-opts:
      - --buildtype=release
    sources:
      - type: dir
        path: .
